pipeline{
  agent any
  environment{
    APP_NAME = "sample-app"
  }
  options{
    timestamps()
  }
  stages{
    stage('Checkout') {
            steps {
                checkout scm
            }
        }
    stage("Build"){
      steps{
        echo "${APP_NAME} is built..."
      }
    }  
    stage("Test"){
      steps{
        echo "Test is completed.."
      }
    }  
    stage("Package"){
      parallel{
        stage('Create JAR') {
            steps {
                echo "üì¶ JAR packaged."
            }
        }
        stage('Docker Image') {
            steps {
                echo "üê≥ Docker image built."
            }
        }
      }
    }
     stage('Deploy') {
            steps {
                script {
                    def branch = env.BRANCH_NAME ?: sh(
                        returnStdout: true,
                        script: "git rev-parse --abbrev-ref HEAD || git name-rev --name-only HEAD"
                    ).trim()

                    branch = branch.replaceFirst(/^remotes\\/origin\\//, '').replaceFirst(/^.*\\//, '')

                    echo "Environment - ${branch}"
                    echo(branch == "main" ? "Deploying to PROD" : "Deploying to DEV")
                }
            }
        }
  }
   
  post {
        success {
            echo "‚úÖ Pipeline completed successfully!"
        }
        failure {
            echo "‚ùå Pipeline failed ‚Äî check logs."
        }
        always {
            echo "üîî Pipeline run finished (success or fail)."
        }
    }
}
      
